!function(){function t(t,a,e,i,n,o,d,r){var l=this,s={breakdown_bight:"",colorArr:["#FB743A","#2ACE8C","#CEBF2E","#429BFF","#0FE400"]};l.initData={totalDeviceCount:0,currentDay:"",queryDeviceListCondition:{multiCriteria:""},fault:"",online:"",outline:"",deviceState:{},deviceQueryInfo:[],alarmDeviceInfo:[]},l.initFunctions={initFunc:function(){switch(a.getIotObjectListCount().then(function(t){l.initData.totalDeviceCount=t.data}),a.getIotObjectAllListData().then(function(t){var a=t.data;a&&(a.forEach(function(t,a,e){t.detailJson&&(t.detailJson=JSON.parse(t.detailJson))}),l.initData.deviceQueryInfo=a,l.initData.alarmDeviceInfo=[])}),(new Date).getDay()){case 1:l.initData.currentDay="星期一";break;case 2:l.initData.currentDay="星期二";break;case 3:l.initData.currentDay="星期三";break;case 4:l.initData.currentDay="星期四";break;case 5:l.initData.currentDay="星期五";break;case 6:l.initData.currentDay="星期六";break;case 7:l.initData.currentDay="星期日"}},gotoDetails:function(t){d.go("manager.deviceList.details",{id:l.initData.deviceQueryInfo[t].id})},queryDeviceList:function(){var t={multiCriteria:l.initData.queryDeviceListCondition.multiCriteria};a.getIotObjectAllListData(t).then(function(t){var a=t.data;a&&(a.forEach(function(t,a,e){t.detailJson&&(t.detailJson=JSON.parse(t.detailJson))}),l.initData.deviceQueryInfo=a)})},initDataItems:function(){a.getDataItemListData().then(function(t){for(var a=t.data,e=$(".dataItem"),i=0;i<e.length;i++)for(var n=0;n<a.length;n++)if($(e[i]).data("dataitemname")===a[n].dataItemName){console.log(44),console.log($(e[i]).data("dataitemname")),$(e[i]).data("dataitemid",a[n].dataItemId),a[n].unit&&$(e[i]).data("unit",a[n].unit);break}console.log($("#breakdown").data("dataitemname")),l.initFunctions.loadBasicInfo(),l.initFunctions.getDeviceActual(),l.initFunctions.getUnnormalDevice(),l.initFunctions.getalarmTop5List(),l.initFunctions.getBreakdownTop5List()})},getDeviceActual:function(){var t={dataTemplateId:"58d36b454d70a07303000012",dataItemId:"58d36b454d70a07303000025"},a=[{iotObjectId:"11111",dataItemId:$("#device_state").data("dataitemid")}],n={time:3600,iotObjectAndItems:JSON.stringify(a),dtProp:0,additionalOper:JSON.stringify(t)};i.getRealRecordByAddOper(n).then(function(t){if(t.data&&t.data.operCode==r.SUCCESS){var a=t.data.data;console.log(a),l.initData.deviceState=a}else e.msg(t.message,{icon:5,shift:6})})},getUnnormalDevice:function(){var t={dataTemplateId:"58d36b454d70a07303000012",dataItemId:"58d36b454d70a07303000023"},a=[{iotObjectId:"11111",dataItemId:$("#fault").data("dataitemid")},{iotObjectId:"11111",dataItemId:$("#online").data("dataitemid")}],n={time:100,iotObjectAndItems:JSON.stringify(a),dtProp:0,uniteTime:0,additionalOper:JSON.stringify(t)};i.getRealRecordByAddOper(n).then(function(t){if(t.data&&t.data.operCode==r.SUCCESS){var a=t.data.data;null!==a&&void 0!==a&&0!==a.length&&(l.initData.fault=a.fault,l.initData.online=a.online,l.initData.outline=a.offline)}else e.msg(t.message,{icon:5,shift:6})})},getalarmTop5List:function(){var t={dataTemplateId:"58d36b454d70a07303000012",dataItemId:"58d36b454d70a07303000026"};console.log(55,$("#alarm").data("dataitemid"));var a=[{iotObjectId:"11111",dataItemId:$("#alarm").data("dataitemid")}],n={time:100,iotObjectAndItems:JSON.stringify(a),dtProp:0,uniteTime:0,additionalOper:JSON.stringify(t)};i.getRealRecordByAddOper(n).then(function(t){if(t.data&&t.data.operCode==r.SUCCESS){var a=t.data.data;null!==a&&void 0!==a&&0!==a.length&&(l.initData.alarmDeviceInfo=a)}else e.msg(t.message,{icon:5,shift:6})})},getBreakdownTop5List:function(){var t={dataTemplateId:"58d36b454d70a07303000012",dataItemId:"58d36b454d70a07303000027"},a=[{iotObjectId:"11111",dataItemId:$("#breakdown_bight").data("dataitemid")}],n={time:100,iotObjectAndItems:JSON.stringify(a),dtProp:0,uniteTime:0,additionalOper:JSON.stringify(t)};i.getRealRecordByAddOper(n).then(function(t){if(t.data&&t.data.operCode==r.SUCCESS){var a=t.data.data.faultDistribution;if(console.log(a),null!==a&&0!==a.length&&void 0!==a){var i=[];a.forEach(function(t,a,e){t.detailJson&&(t.detailJson=JSON.parse(t.detailJson));for(x in t){var n={name:x,y:parseInt(t[x]),color:s.colorArr[a]};i.push(n)}}),s.breakdown_bight.series[0].update({data:i})}}else e.msg(t.message,{icon:5,shift:6})})},loadBasicInfo:function(){s.breakdown_bight=Highcharts.chart("breakdown_bight",{chart:{height:180,spacing:[0,0,0,0],margin:[20,40,0,-70],backgroundColor:"#192847"},credits:{enabled:!1},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>{point.percentage:.1f}%</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!1},showInLegend:!0}},exporting:{enabled:!1},legend:{enabled:!0,align:"right",layout:"vertical",verticalAlign:"top",squareSymbol:!1,borderRadius:0,x:-10,y:20,itemMarginBottom:10,itemStyle:{color:"{point.color}"},itemHoverStyle:{color:"#ffffff"},symbolWidth:16,symbolHeight:7,labelFormatter:function(){return'<span style="color: '+this.color+';line-height:18px">'+this.name+"</span>"}},series:[{type:"pie",innerSize:"70%",name:"市场份额",data:[{name:"系统崩溃",y:24,color:"#FB743A",legendIndex:1},{name:"程序更新",y:16,color:"#2ACE8C"},{name:"插件不兼容",y:24,color:"#CEBF2E"},{name:"操作不当",y:25,color:"#429BFF"},{name:"设备断电",y:11,color:"#0FE400"}]}]});var t={dataTemplateId:"58d36b454d70a07303000012",dataItemId:"58d36b454d70a07303000023"},e=[{iotObjectId:"11111",dataItemId:$("#fault").data("dataitemid")},{iotObjectId:"11111",dataItemId:$("#online").data("dataitemid")}],i={dataItemId:JSON.stringify(e),additionalOper:JSON.stringify(t)};a.getAreaStation(i).then(function(t){var a=t.data,e=[];Highcharts.each(a.features,function(t,a){var i={name:t.properties.name,value:Math.floor(100*Math.random()+1)};t.properties.drilldown&&(i.drilldown=t.properties.drilldown),e.push(i)}),n=new Highcharts.Map("map",{chart:{height:655,backgroundColor:"#182033",events:{drilldown:function(t){if(this.tooltip.hide(),t.point.drilldown){var a=t.point.properties.fullname;n.showLoading("下钻中，请稍后..."),$.getJSON(o+t.point.drilldown+".json&callback=?",function(e){e=Highcharts.geojson(e),Highcharts.each(e,function(t){t.properties.drilldown&&(t.drilldown=t.properties.drilldown),t.value=Math.floor(100*Math.random()+1)}),n.hideLoading(),n.addSeriesAsDrilldown(t.point,{name:t.point.name,data:e,dataLabels:{enabled:!0,format:"{point.name}"}}),n.setTitle({text:a})})}},drillup:function(){n.setTitle({text:"中国"})}}},credits:{enabled:!1},title:{text:""},subtitle:{text:""},exporting:{enabled:!1},mapNavigation:{enabled:!1,buttonOptions:{verticalAlign:"bottom"}},tooltip:{useHTML:!0,headerFormat:"<table ><tr><td>{point.name}</td></tr>",pointFormat:'<tr><td style="font-size:20px" colspan="2">{point.properties.fullname}</td></tr><tr style="font-size:16px"><td >  设备总数 : </td><td>{point.properties.totalNum}</td></tr><tr style="font-size:16px"><td >  在线设备 : </td><td>{point.properties.online}</td></tr><tr style="font-size:16px"><td >  故障设备 : </td><td>{point.properties.fault}</td></tr><tr style="font-size:16px"><td >  离线设备 : </td><td>{point.properties.offline}</td></tr>',footerFormat:"</table>"},legend:{enabled:!1},series:[{data:e,mapData:a,joinBy:"name",name:"中国地图",color:"#18B3EC",states:{hover:{color:"#a4edba"}}}],plotOptions:{series:{dataLabels:{enabled:!0,useHTML:!0,formatter:function(){if(this.point.properties.totalNum&&0!=this.point.properties.totalNum){var t=this.point.properties.totalNum,a=50;a+=5*t>255?255:5*t;var e="rgb("+a+",0,0)";return console.log(t,e),'<div style="width:'+t+"px;height:"+t+"px;background:"+e+";border-radius:"+t+'px;"></div>'}}},marker:{radius:3}}}})});var n=null,o="/src/app/manager/home/mapdata.json"}},l.initFunctions.initFunc(),l.initFunctions.initDataItems()}angular.module("app.managerModule.home").controller("HomeController",t),t.$inject=["$scope","JEEAPI","layer","API","session","MD5","$state","TEMPLATEDATA"]}();