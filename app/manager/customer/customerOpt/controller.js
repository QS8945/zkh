!function(){function e(e,t,i,n,o,s,a,r,d,l){var p=this,m={initMap:function(){function e(e){window.poiPicker=e;var t=new AMap.Marker,i=new AMap.InfoWindow({offset:new AMap.Pixel(0,-20)});e.on("poiPicked",function(e){var n=e.source,o=e.item;o.id,o.name,o.location.toString(),o.address;t.setMap(m.map),i.setMap(m.map),t.setPosition(o.location),i.setPosition(o.location),i.setContent("位置信息: <pre>名称:"+o.name+"<br>地址:"+o.address+"<br></pre>"),i.open(m.map,t.getPosition()),m.map.setCenter(t.getPosition()),p.initTools.item.extend.extendS1.address=o.location.toString()})}m.map=new AMap.Map("container",{zoom:10}),AMapUI.loadUI(["misc/PoiPicker"],function(t){e(new t({input:"tipinput"}))})}};switch(p.initTools={item:{companyType:"1",extend:{extendS1:{responsiblePersonList:[{responsiblePerson:"",responsibleTel:""}]}}},uploadIcon:function(t){var n=t.files[0];if("image/png"!==n.type&&"image/jpeg"!==n.type)return i.msg("请上传jpg或png格式图片");var o=new FileReader;o.onload=function(){var t=n.size,s=l.Logo_Max_Size;if(s*=1024,!(t<=s))return i.msg("请上传2M以内图片");e.$apply(function(){p.initTools.item.previewImg=o.result})},n&&o.readAsDataURL(n)},uploadClick:function(){$("#iconFile").click()},saveForm:function(){var t=e.customerOpt;if(t.$invalid){var n=t.$error;for(item in n)return $(n[item][0].$$element[0]).focus(),i.msg("请填写正确的信息")}if(!p.initTools.item.previewImg)return i.msg("请上传图片");var o={userProvince:p.initTools.item.extend.extendS1.userProvince,fullName:p.initTools.item.extend.extendS1.fullName,userCity:p.initTools.item.extend.extendS1.userCity,userArea:p.initTools.item.extend.extendS1.userArea,companyAddress:p.initTools.item.extend.extendS1.companyAddress,companyTel:p.initTools.item.extend.extendS1.companyTel,responsiblePersonList:JSON.stringify(p.initTools.item.extend.extendS1.responsiblePersonList),email:p.initTools.item.extend.extendS1.email,address:p.initTools.item.extend.extendS1.address},s={companyCode:p.initTools.item.companyCode,viewCode:p.initTools.item.companyCode,companyName:p.initTools.item.companyName,fullName:p.initTools.item.companyName,companyType:p.initTools.item.companyType,parentCode:p.initTools.item.parentCode,treeSort:70,"parent.id":"0","extend.extendS1":JSON.stringify(o),previewImg:p.initTools.item.previewImg};for(var r in s)(""===s[r]||null===s[r]||void 0===s[r])&&delete s[r];d.getCompanySave(s).then(function(e){"true"===e.data.result&&a.reload()})},getProvince:function(){n.getAddress().then(function(e){p.initTools.provinces=e.data.data,p.initTools.item.extend.extendS1.userProvince=p.initTools.provinces[0].id,p.initTools.getUserCities()})},getUserCities:function(){n.getAddress({parentNodeId:p.initTools.item.extend.extendS1.userProvince}).then(function(e){p.initTools.cities=e.data.data,p.initTools.item.extend.extendS1.userCity=p.initTools.cities[0].id,p.initTools.getUserAreas()})},getUserAreas:function(){n.getAddress({parentNodeId:p.initTools.item.extend.extendS1.userCity}).then(function(e){p.initTools.areas=e.data.data,p.initTools.item.extend.extendS1.userArea=p.initTools.areas[0].id})},getAreaListData:function(e,t){var i={};t&&(i.areaType=t),e&&(i.parentCode=e),d.getAreaListData(i).then(function(e){var t=e.data;t.length&&(1==t[0].areaType?(p.initTools.item.extend.extendS1.userProvince||(p.initTools.item.extend.extendS1.userProvince=t[0].areaCode),p.initTools.provinces=e.data,p.initTools.getAreaListData(p.initTools.item.extend.extendS1.userProvince)):2==t[0].areaType?(p.initTools.item.extend.extendS1.userCity||(p.initTools.item.extend.extendS1.userCity=t[0].areaCode),p.initTools.cities=e.data,p.initTools.getAreaListData(p.initTools.item.extend.extendS1.userCity)):3==t[0].areaType&&(p.initTools.item.extend.extendS1.userArea||(p.initTools.item.extend.extendS1.userArea=t[0].areaCode),p.initTools.areas=e.data))})},getAreaListDataChange:function(e,t){var i={};t&&(i.areaType=t),e&&(i.parentCode=e),d.getAreaListData(i).then(function(e){var t=e.data;t.length&&(2==t[0].areaType?(p.initTools.item.extend.extendS1.userCity=t[0].areaCode,p.initTools.cities=e.data,p.initTools.getAreaListDataChange(p.initTools.item.extend.extendS1.userCity)):3==t[0].areaType&&(p.initTools.item.extend.extendS1.userArea=t[0].areaCode,p.initTools.areas=e.data))})},removeImg:function(){i.confirm("您确定要清除图片吗",{icon:3},function(e){p.initTools.item.previewImg="",$("#iconFile").val(""),$("#previewImg").attr("src",""),i.close(e)})},getCompanyTypes:function(){"0"===p.initTools.item.companyType&&d.getCompanyListData({companyType:p.initTools.item.companyType}).then(function(e){p.initTools.companyTypes=e.data,p.initTools.item.parentCode=p.initTools.item.parentCode||"0"})},addContact:function(){if(p.initTools.item.extend.extendS1.responsiblePersonList.length>4)return i.msg("请勿添加五条以上联系人");var e={responsiblePerson:"",responsibleTel:""};p.initTools.item.extend.extendS1.responsiblePersonList.push(e)},removeContact:function(e){p.initTools.item.extend.extendS1.responsiblePersonList.splice(e,1)}},p.initTools.type=t.type,p.initTools.type){case"ins":p.initTools.title="新增客户";break;case"sel":p.initTools.title="客户详情";break;case"upd":p.initTools.title="更新客户"}m.initMap(),t.id?(m.id=t.id,d.getCompanyForm({companyCode:m.id}).then(function(e){if(e.data.company.extend.extendS1=JSON.parse(e.data.company.extend.extendS1),e.data.company.extend.extendS1.responsiblePersonList)e.data.company.extend.extendS1.responsiblePersonList=JSON.parse(e.data.company.extend.extendS1.responsiblePersonList);else{var t={responsiblePerson:"",responsibleTel:""};e.data.company.extend.extendS1.responsiblePersonList=[],e.data.company.extend.extendS1.responsiblePersonList.push(t)}if(p.initTools.item=e.data.company,p.initTools.getCompanyTypes(),p.initTools.getAreaListData("",1),p.initTools.item.extend.extendS1.address){var i,n;i||(i=new AMap.Geocoder({radius:1e3})),n=p.initTools.item.extend.extendS1.address.split(","),i.getAddress(n,function(e,t){if("complete"===e&&t.regeocode){var i=t.regeocode.formattedAddress;m.addressName=i,marker=new AMap.Marker,m.map.add(marker);var o=new AMap.InfoWindow({offset:new AMap.Pixel(0,-20)});o.setMap(m.map),marker.setPosition(n),o.setPosition(n),o.setContent("位置信息: <pre>地址:"+m.addressName+"<br></pre>"),o.open(m.map,marker.getPosition()),m.map.setCenter(marker.getPosition())}else alert(JSON.stringify(t))})}})):p.initTools.getAreaListData("",1)}angular.module("app.managerModule.customer.opt").controller("CustomerOptController",e),e.$inject=["$scope","$stateParams","layer","API","session","MD5","$state","TEMPLATEDATA","JEEAPI","COMMONJS"]}();