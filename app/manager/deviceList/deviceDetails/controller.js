!function(){function t(t,a,e,i,d,n,m,o,I){var l=this,s={pageSelectCallBack:function(t,a){l.initData.pageNum=t+1,l.initFunctions.showIotObjectHistoryListData()}};l.initTools={compressors:[{name:"空压机类型1",id:"1"},{name:"空压机类型2",id:"2"},{name:"空压机类型3",id:"3"},{name:"空压机类型4",id:"4"}],compressorBrands:[{name:"空压机品牌1",id:"1"},{name:"空压机品牌2",id:"2"},{name:"空压机品牌3",id:"3"},{name:"空压机品牌4",id:"4"}],compressorModels:[{name:"空压机型号1",id:"1"},{name:"空压机型号2",id:"2"},{name:"空压机型号3",id:"3"},{name:"空压机型号4",id:"4"}],controllerTypes:[{name:"控制器类型1",id:"1"},{name:"控制器类型2",id:"2"},{name:"控制器类型3",id:"3"},{name:"控制器类型4",id:"4"}],noseTypes:[{name:"机头类型1",id:"1"},{name:"机头类型2",id:"2"},{name:"机头类型3",id:"3"},{name:"机头类型4",id:"4"}],frequencies:[{name:"变频",id:"1"},{name:"工频",id:"2"}],devicestatuses:[{name:"启用",id:"0"},{name:"报废",id:"1"}],collectorTypes:[{name:"有人物联",id:"1"},{name:"丹唯思",id:"2"}],collectorNos:[{name:"采集器序列号1",id:"1"},{name:"采集器序列号2",id:"2"},{name:"采集器序列号3",id:"3"},{name:"采集器序列号4",id:"4"}]},l.initData={companyName:a.companyName,iotObjectId:a.id,iotObjectAndItem:[],iotObjectAndItemHistory:[],totalNum:0,pageSize:"10",pageNum:0,pageTypes:[10],startTime:"",endTime:"",historyJsonList:[],availabilityRate:"",alarmList:[],dataItemsArr:[{dataItemName:"供气压力",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"排气温度",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"本次运行",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"本次负载",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机电流A",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机电流B",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机电流C",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"油滤器使用时间",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"油分器使用时间",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"空滤器使用时间",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"润滑油使用时间",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"润滑脂使用时间",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"系统压力",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"前轴承温度",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机电流A",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机电流B",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机电流C",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"预警",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"运行状态",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"故障",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"故障值",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机输出电压",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机输出电流",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机输出频率",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机输出功率",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机输出电压",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机输出电流",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机输出频率",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机输出功率",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机转速",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机转速",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机状态字",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机状态字",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机本次用电",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"后轴承温度",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"油分压差",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机本次用电",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"故障字",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"主机累计用电",dataItemId:"",unit:"",dataItemValue:""},{dataItemName:"风机累计用电",dataItemId:"",unit:"",dataItemValue:""}]},l.initFunctions={initFunc:function(){$(".dataTime").jeDate({skinCell:"jedateblue",format:"YYYY-MM-DD hh:mm:ss",maxDate:$.nowDate(0),isTime:!0,festival:!0});var t={id:a.id};I.getIotObjectForm(t).then(function(t){var a=t.data.iotObject;console.log(999,l.initTools.compressors),a&&(a.detailJson&&(a.detailJson=JSON.parse(a.detailJson)),a.iotStation.detailJson&&(a.iotStation.detailJson=JSON.parse(a.iotStation.detailJson)),l.initTools.compressors.forEach(function(t,e,i){a.iotTypeId==t.id&&a.iotTypeId&&(a.iotTypeId=t.name)}),l.initTools.compressorBrands.forEach(function(t,e,i){a.detailJson.compressorBrand==t.id&&a.detailJson.compressorBrand&&(a.detailJson.compressorBrand=t.name)}),l.initTools.compressorModels.forEach(function(t,e,i){a.detailJson.compressorModel==t.id&&a.detailJson.compressorModel&&(a.detailJson.compressorModel=t.name)}),l.initTools.controllerTypes.forEach(function(t,e,i){a.detailJson.controllerType==t.id&&a.detailJson.controllerType&&(a.detailJson.controllerType=t.name)}),l.initTools.collectorNos.forEach(function(t,e,i){a.detailJson.collectorNo==t.id&&a.detailJson.collectorNo&&(a.detailJson.collectorNo=t.name)}),l.initTools.devicestatuses.forEach(function(t,e,i){a.detailJson.devicestatus==t.id&&a.detailJson.devicestatus&&(a.detailJson.devicestatus=t.name)}),l.initTools.collectorNos.forEach(function(t,e,i){a.detailJson.collectorNo==t.id&&a.detailJson.collectorNo&&(a.detailJson.collectorNo=t.name)}),l.initTools.collectorTypes.forEach(function(t,e,i){a.detailJson.collectorType==t.id&&a.detailJson.collectorType&&(a.detailJson.collectorType=t.name)}),l.initData.currentDeviceInfo=a)}),I.getDataItemListData().then(function(t){for(var a=t.data,d=$(".dataItem"),n=0;n<d.length;n++)for(var m=0;m<a.length;m++)if($(d[n]).data("dataitemname")===a[m].dataItemName){$(d[n]).data("dataitemid",a[m].dataItemId),a[m].unit&&$(d[n]).data("unit",a[m].unit);var I={iotObjectId:l.initData.iotObjectId,dataItemId:a[m].dataItemId};l.initData.iotObjectAndItem.push(I);break}for(var n=0;n<l.initData.dataItemsArr.length;n++)for(var m=0;m<a.length;m++)if(l.initData.dataItemsArr[n].dataItemName===a[m].dataItemName){l.initData.dataItemsArr[n].dataItemId=a[m].dataItemId,a[m].unit&&(l.initData.dataItemsArr[n].unit=a[m].unit);var I={iotObjectId:l.initData.iotObjectId,dataItemId:a[m].dataItemId};l.initData.iotObjectAndItemHistory.push(I);break}0!==l.initData.iotObjectAndItem.length&&i.getReadRealOne({iotObjectAndItems:JSON.stringify(l.initData.iotObjectAndItem)}).then(function(t){if(t.data&&t.data.operCode==o.SUCCESS){var a=t.data.data.data;if(null!==a&&0!==a.length&&void 0!==a)for(var i=$(".dataItem"),d=0;d<i.length;d++)for(var n=0;n<a.length;n++)$(i[d]).data("dataitemid")===a[n].dataItemId&&$(i[d]).html($(i[d]).data("dataitemname")+"："+a[n].dataValue+$(i[d]).data("unit"))}else e.alert(t.message,{icon:5,shift:6})})})},getRealAlarmList:function(){var t={dataTemplateId:"58d36b454d70a07303000012",dataItemId:"58d36b454d70a07303000030"},a=[{iotObjectId:l.initData.iotObjectId,dataItemId:"5c2491db9cd54a29acd5f9dc"},{iotObjectId:l.initData.iotObjectId,dataItemId:"5c2494009cd54a29acd5fa0e"}],d={time:3600,iotObjectAndItems:JSON.stringify(a),dtProp:0,additionalOper:JSON.stringify(t)};i.getRealRecordByAddOper(d).then(function(t){if(t.data&&t.data.operCode==o.SUCCESS){var a=t.data.data;null!==a&&0!==a.length&&void 0!==a&&(a.forEach(function(t,a,e){t.warningTime&&(t.warningTime=l.initFunctions.currentTime(new Date(t.warningTime)))}),l.initData.alarmList=a,console.log(a))}else e.msg(t.message,{icon:5,shift:6})})},getAvailabilityRate:function(){var t={dataTemplateId:"58d36b454d70a07303000012",dataItemId:"58d36b454d70a07303000031"},a=[{iotObjectId:l.initData.iotObjectId,dataItemId:"5c2494009cd54a29acd5fa0e"}],d={time:3600,iotObjectAndItems:JSON.stringify(a),dtProp:0,additionalOper:JSON.stringify(t)};i.getRealRecordByAddOper(d).then(function(t){if(t.data&&t.data.operCode==o.SUCCESS){var a=t.data.data;console.log(a),null!==a&&0!==a.length&&void 0!==a&&(l.initData.availabilityRate=a.availabilityRate)}else e.msg(t.message,{icon:5,shift:6})})},tabChange:function(t){"I"!==t.target.tagName&&"DIV"!==t.target.tagName&&$(t.target).children("i").addClass("active").siblings("div").show().parent().siblings().children("i").removeClass("active").siblings("div").hide()},showIotObjectHistoryListData:function(){if(0!==l.initData.iotObjectAndItemHistory.length){l.initData.historyJsonList=[];var t={dtProp:0,uniteTime:0,iotObjectAndItems:JSON.stringify(l.initData.iotObjectAndItemHistory),startTime:$(".startTime").val(),endTime:$(".endTime").val(),timePrecision:"s"};0==l.initData.pageNum?t.pageNum=0:t.pageNum=l.initData.pageNum-1,i.getHistoryInfo(t).then(function(t){if(t.data&&t.data.operCode==o.SUCCESS){var a=t.data.data.dataList;if(null!==a&&0!==a.length&&void 0!==a){for(var i=0;i<a.length;i++){for(var d={key:a[i].key,value:[]},n=0;n<l.initData.dataItemsArr.length;n++)for(var m=0;m<a[i].value.length;m++){if(a[i].value[m].dataItemId==l.initData.dataItemsArr[n].dataItemId){d.value.push(a[i].value[m].dataValue+a[i].value[m].unit);break}m==a[i].value.length-1&&d.value.push("")}l.initData.historyJsonList.push(d)}console.log(l.initData.historyJsonList),l.initData.totalNum=t.data.data.totalPageCount,$("#Pagination").pagination(l.initData.totalNum,{items_per_page:l.initData.pageSize,num_edge_entries:1,num_display_entries:3,current_page:l.initData.pageNum,prev_text:"<",next_text:">",callback:s.pageSelectCallBack})}}else e.alert(t.message,{icon:5,shift:6})})}},currentTime:function(t){var a=t.getFullYear(),e=t.getMonth()+1;e=e<10?"0"+e:e;var i=t.getDate();i=i<10?"0"+i:i;var d=t.getHours(),n=t.getMinutes(),m=t.getSeconds();return d=d<10?"0"+d:d,n=n<10?"0"+n:n,m=m<10?"0"+m:m,a+"/"+e+"/"+i+" "+d+":"+n+":"+m}},l.initFunctions.initFunc(),l.initFunctions.getRealAlarmList(),l.initFunctions.getAvailabilityRate()}angular.module("app.managerModule.deviceList.details").controller("DeviceDetailsController",t),t.$inject=["$scope","$stateParams","layer","API","session","MD5","$state","TEMPLATEDATA","JEEAPI"]}();