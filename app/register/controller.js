!function(){function t(t,e,a,i,n,r,s){var o=this;o.initData={promise:"",registerCategory:"1",userNickName:"",username:"",inputPassword:"",confirmPassword:"",passwordHint:"",userPhone:"",userEmail:"",userProvince:"",userCity:"",userArea:"",provinces:"",cities:"",areas:"",inputCode:"",protocol:"",agreeProtocol:!1,getCode:function(){a.getCode().then(function(t){o.imgCode="data:image/jpeg;base64,"+t.data.data.code.imgBase64,console.log(t.data.data.sessionId),i.setLocal("sessionId",t.data.data.sessionId)},function(){e.alert("获取验证码失败",{icon:5,shift:6})})},getProvince:function(){a.getAddress().then(function(t){o.initData.provinces=t.data.data,o.initData.userProvince=o.initData.provinces[0].id,o.initData.getUserCities()})},getUserCities:function(){a.getAddress({parentNodeId:o.initData.userProvince}).then(function(t){o.initData.cities=t.data.data,o.initData.userCity=o.initData.cities[0].id,o.initData.getUserAreas()})},getUserAreas:function(){a.getAddress({parentNodeId:o.initData.userCity}).then(function(t){o.initData.areas=t.data.data,o.initData.userArea=o.initData.areas[0].id})},agreeDetail:function(){var i=t.$new(!0);a.getFindConfigByType({type:"REGISTER_AGREEMENT"}).then(function(t){i.protocol=t.data.data.data});var n=e.open({type:1,title:"ASSIOT组景慧物联平台服务协议",shadeClose:!0,shade:.8,scope:i,shift:0,area:["350px","500px"],contentUrl:"./app/register/protocol.html",btn:["确认"],yes:function(){o.initData.agreeProtocol=!0,e.close(n)}})},goToRegister:function(){if(t.register_form.$invalid)return e.msg("请填写正确的信息");if(!o.initData.agreeProtocol)return o.initData.agreeDetail();var i={userType:o.initData.registerCategory,userName:o.initData.username,userNickName:o.initData.userNickName,passwordHint:"123",currentPassword:n.hex_md5(o.initData.inputPassword),userPhone:o.initData.userPhone,email:o.initData.userEmail,province:o.initData.userProvince,city:o.initData.userCity,zone:o.initData.userArea,valcode:o.initData.inputCode};a.getRegist(i).then(function(t){t.data&&t.data.operCode==s.SUCCESS?e.alert("注册成功，请等待管理员审核通过",{icon:6},function(t){r.go("mySpace"),e.close(t)}):e.alert(t.message,{icon:5,shift:6})})}},this.initData.getCode(),this.initData.getProvince()}angular.module("app.registerModule").controller("registerController",t),t.$inject=["$scope","layer","API","session","MD5","$state","TEMPLATEDATA"]}();